{"ast":null,"code":"import { createStore } from 'vuex';\nimport axios from 'axios';\nimport { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth';\nimport { getFirestore, collection, addDoc, getDocs, doc, getDoc, updateDoc, query, orderBy, where } from 'firebase/firestore';\n\n// API 기본 URL 설정\naxios.defaults.baseURL = process.env.VUE_APP_API_URL || 'http://localhost:8000';\n\n// axios 인터셉터 설정\naxios.interceptors.request.use(config => {\n  // 로컬 스토리지에서 사용자 정보 가져오기\n  const adminUser = localStorage.getItem('adminUser');\n  const tempUser = localStorage.getItem('tempUser');\n  const user = adminUser ? JSON.parse(adminUser) : tempUser ? JSON.parse(tempUser) : null;\n\n  // 사용자가 로그인한 경우 헤더에 인증 정보 추가\n  if (user) {\n    // 실제 토큰이 없으므로 임시 인증 헤더 추가\n    config.headers['Authorization'] = `Bearer dummy-token-for-${user.email}`;\n  } else {\n    // 사용자 정보가 없는 경우에도 임시 인증 헤더 추가 (401 에러 방지)\n    config.headers['Authorization'] = `Bearer dummy-token-for-anonymous`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// 응답 인터셉터 설정\naxios.interceptors.response.use(response => {\n  return response;\n}, error => {\n  // 401 에러 처리 (인증 실패)\n  if (error.response && error.response.status === 401) {\n    console.error('인증 오류가 발생했습니다:', error.response.data);\n\n    // 로그인 페이지로 이동하는 대신 콘솔에 오류 메시지만 출력\n    // 로컬 스토리지와 사용자 정보는 유지\n    // 로그인 페이지로 리다이렉트하지 않음\n  }\n  return Promise.reject(error);\n});\nconst store = createStore({\n  state: {\n    user: null,\n    scenarios: [],\n    currentScenario: null,\n    loading: false,\n    error: null\n  },\n  getters: {\n    isLoggedIn: state => !!state.user,\n    currentUser: state => state.user,\n    isAdmin: state => state.user && state.user.is_admin,\n    scenarios: state => state.scenarios,\n    currentScenario: state => state.currentScenario,\n    isLoading: state => state.loading,\n    error: state => state.error\n  },\n  mutations: {\n    SET_USER(state, user) {\n      state.user = user;\n    },\n    SET_SCENARIOS(state, scenarios) {\n      state.scenarios = scenarios;\n    },\n    SET_CURRENT_SCENARIO(state, scenario) {\n      state.currentScenario = scenario;\n    },\n    SET_LOADING(state, loading) {\n      state.loading = loading;\n    },\n    SET_ERROR(state, error) {\n      state.error = error;\n    },\n    CLEAR_ERROR(state) {\n      state.error = null;\n    }\n  },\n  actions: {\n    // 인증 상태 확인\n    checkAuth({\n      commit\n    }) {\n      // 로컬 스토리지에서 관리자 로그인 상태 확인\n      const adminUser = localStorage.getItem('adminUser');\n      if (adminUser) {\n        commit('SET_USER', JSON.parse(adminUser));\n        return;\n      }\n\n      // 로컬 스토리지에서 임시 사용자 로그인 상태 확인\n      const tempUser = localStorage.getItem('tempUser');\n      if (tempUser) {\n        commit('SET_USER', JSON.parse(tempUser));\n        return;\n      }\n\n      /* Firebase 인증 코드 주석 처리 (오류 발생)\r\n      const auth = getAuth()\r\n      onAuthStateChanged(auth, async (user) => {\r\n        if (user) {\r\n          try {\r\n            // Firebase 인증 후 사용자 정보 설정\r\n            const db = getFirestore()\r\n            const userRef = collection(db, 'users')\r\n            const q = query(userRef, where('email', '==', user.email))\r\n            const querySnapshot = await getDocs(q)\r\n            \r\n            if (!querySnapshot.empty) {\r\n              // 기존 사용자 정보 가져오기\r\n              const userData = querySnapshot.docs[0].data()\r\n              commit('SET_USER', {\r\n                id: querySnapshot.docs[0].id,\r\n                username: userData.username || user.displayName || user.email,\r\n                email: user.email,\r\n                is_admin: userData.is_admin || false\r\n              })\r\n            } else {\r\n              // 새 사용자 정보 생성\r\n              const newUser = {\r\n                username: user.displayName || user.email,\r\n                email: user.email,\r\n                is_admin: user.email === 'admin@example.com', // 관리자 계정 설정\r\n                created_at: new Date().toISOString()\r\n              }\r\n              \r\n              const docRef = await addDoc(userRef, newUser)\r\n              commit('SET_USER', {\r\n                id: docRef.id,\r\n                ...newUser\r\n              })\r\n            }\r\n          } catch (error) {\r\n            console.error('사용자 정보 가져오기 실패:', error)\r\n            commit('SET_USER', null)\r\n          }\r\n        } else {\r\n          commit('SET_USER', null)\r\n        }\r\n      })\r\n      */\n    },\n    // 로그인\n    async login({\n      commit\n    }, {\n      email,\n      password\n    }) {\n      commit('SET_LOADING', true);\n      commit('CLEAR_ERROR');\n      try {\n        // 관리자 계정 특별 처리 (admin@example.com / password123!)\n        if (email === 'admin@example.com' && password === 'password123!') {\n          const adminUser = {\n            id: 'admin-user-id',\n            username: 'Admin',\n            email: 'admin@example.com',\n            is_admin: true\n          };\n          commit('SET_USER', adminUser);\n          // 관리자 계정 정보를 로컬 스토리지에 저장\n          localStorage.setItem('adminUser', JSON.stringify(adminUser));\n          commit('SET_LOADING', false);\n          return adminUser;\n        }\n\n        // 일반 사용자 처리 (Firebase 인증 없이 임시 처리)\n        // Firebase 인증 오류 방지를 위해 임시 사용자 생성\n        if (email && email.includes('@') && password && password.length >= 6) {\n          const tempUser = {\n            id: 'user-' + Date.now(),\n            username: email.split('@')[0],\n            email: email,\n            is_admin: false,\n            created_at: new Date().toISOString()\n          };\n          commit('SET_USER', tempUser);\n          localStorage.setItem('tempUser', JSON.stringify(tempUser));\n          commit('SET_LOADING', false);\n          return tempUser;\n        } else {\n          throw new Error('유효한 이메일과 6자 이상의 비밀번호를 입력해주세요.');\n        }\n\n        /* Firebase 인증 코드 주석 처리 (오류 발생)\r\n        const auth = getAuth()\r\n        const userCredential = await signInWithEmailAndPassword(auth, email, password)\r\n        \r\n        // Firebase 인증 후 사용자 정보 설정\r\n        const db = getFirestore()\r\n        const userRef = collection(db, 'users')\r\n        const q = query(userRef, where('email', '==', userCredential.user.email))\r\n        const querySnapshot = await getDocs(q)\r\n        \r\n        if (!querySnapshot.empty) {\r\n          // 기존 사용자 정보 가져오기\r\n          const userData = querySnapshot.docs[0].data()\r\n          const user = {\r\n            id: querySnapshot.docs[0].id,\r\n            username: userData.username || userCredential.user.displayName || userCredential.user.email,\r\n            email: userCredential.user.email,\r\n            is_admin: userData.is_admin || false\r\n          }\r\n          commit('SET_USER', user)\r\n          commit('SET_LOADING', false)\r\n          return user\r\n        } else {\r\n          // 새 사용자 정보 생성\r\n          const newUser = {\r\n            username: userCredential.user.displayName || userCredential.user.email,\r\n            email: userCredential.user.email,\r\n            is_admin: userCredential.user.email === 'admin@example.com', // 관리자 계정 설정\r\n            created_at: new Date().toISOString()\r\n          }\r\n          \r\n          const docRef = await addDoc(userRef, newUser)\r\n          const user = {\r\n            id: docRef.id,\r\n            ...newUser\r\n          }\r\n          commit('SET_USER', user)\r\n          commit('SET_LOADING', false)\r\n          return user\r\n        }\r\n        */\n      } catch (error) {\n        commit('SET_ERROR', error.message);\n        commit('SET_LOADING', false);\n        throw error;\n      }\n    },\n    // 회원가입\n    async register({\n      commit\n    }, {\n      username,\n      email,\n      password\n    }) {\n      commit('SET_LOADING', true);\n      commit('CLEAR_ERROR');\n      try {\n        const auth = getAuth();\n        const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n\n        // Firebase Firestore에 사용자 정보 저장\n        const db = getFirestore();\n        const userRef = collection(db, 'users');\n        const newUser = {\n          username,\n          email: userCredential.user.email,\n          is_admin: email === 'admin@example.com',\n          // 관리자 계정 설정\n          created_at: new Date().toISOString()\n        };\n        const docRef = await addDoc(userRef, newUser);\n        const user = {\n          id: docRef.id,\n          ...newUser\n        };\n        commit('SET_USER', user);\n        commit('SET_LOADING', false);\n        return user;\n      } catch (error) {\n        commit('SET_ERROR', error.message);\n        commit('SET_LOADING', false);\n        throw error;\n      }\n    },\n    // 로그아웃\n    async logout({\n      commit\n    }) {\n      try {\n        // 로컬 스토리지에서 관리자 계정 정보 삭제\n        localStorage.removeItem('adminUser');\n        // 로컬 스토리지에서 임시 사용자 정보 삭제\n        localStorage.removeItem('tempUser');\n\n        /* Firebase 인증 코드 주석 처리 (오류 발생)\r\n        const auth = getAuth()\r\n        await signOut(auth)\r\n        */\n\n        commit('SET_USER', null);\n      } catch (error) {\n        commit('SET_ERROR', error.message);\n        throw error;\n      }\n    },\n    // 시나리오 목록 가져오기\n    async fetchScenarios({\n      commit\n    }) {\n      commit('SET_LOADING', true);\n      commit('CLEAR_ERROR');\n      try {\n        // Firebase Firestore에서 시나리오 목록 가져오기\n        const db = getFirestore();\n        const scenariosRef = collection(db, 'scenarios');\n        const q = query(scenariosRef, orderBy('created_at', 'desc'));\n        const querySnapshot = await getDocs(q);\n        const scenarios = [];\n        querySnapshot.forEach(doc => {\n          scenarios.push({\n            id: doc.id,\n            ...doc.data()\n          });\n        });\n        commit('SET_SCENARIOS', scenarios);\n        commit('SET_LOADING', false);\n        return scenarios;\n      } catch (error) {\n        commit('SET_ERROR', error.message);\n        commit('SET_LOADING', false);\n        throw error;\n      }\n    },\n    // 시나리오 상세 정보 가져오기\n    async fetchScenario({\n      commit\n    }, id) {\n      commit('SET_LOADING', true);\n      commit('CLEAR_ERROR');\n      try {\n        console.log(`시나리오 ID ${id} 조회 중...`);\n\n        // Firestore에서 시나리오 조회\n        const db = getFirestore();\n        const scenariosRef = collection(db, 'scenarios');\n        const q = query(scenariosRef, where('id', '==', id.toString()));\n        const querySnapshot = await getDocs(q);\n        let scenario = null;\n        if (!querySnapshot.empty) {\n          // Firestore에서 시나리오 찾음\n          const doc = querySnapshot.docs[0];\n          scenario = {\n            id: doc.id,\n            ...doc.data()\n          };\n          console.log('Firestore에서 시나리오 찾음:', scenario);\n        } else {\n          // Firestore에 없는 경우 백엔드 API 호출\n          console.log('Firestore에 시나리오가 없어 백엔드 API 호출');\n          const response = await axios.get(`/api/scenarios/${id}/`);\n          scenario = response.data;\n          console.log('백엔드 API에서 시나리오 찾음:', scenario);\n\n          // Firestore에 저장\n          await addDoc(scenariosRef, {\n            id: scenario.id.toString(),\n            title: scenario.title,\n            main_disease: scenario.main_disease,\n            personal_info: scenario.personal_info,\n            additional_info: scenario.additional_info || '',\n            content: scenario.content,\n            patient_conversation: scenario.patient_conversation || '',\n            created_by: scenario.created_by ? {\n              id: scenario.created_by.id,\n              username: scenario.created_by.username,\n              email: scenario.created_by.email\n            } : null,\n            created_at: scenario.created_at,\n            updated_at: scenario.updated_at\n          });\n        }\n\n        // 환자와의 대화가 없는 경우 기본 대화 설정\n        if (!scenario.patient_conversation || scenario.patient_conversation.trim() === '') {\n          console.log('환자와의 대화가 없어 기본 대화 설정');\n          scenario.patient_conversation = `\n# 환자와의 대화\n\n## 초기 평가\n**간호사**: 안녕하세요, 저는 오늘 담당 간호사입니다. 어떻게 지내세요? 어디가 불편하신가요?\n\n**환자**: 안녕하세요, 간호사님. 사실 며칠 전부터 계속 가슴이 답답하고 숨이 잘 안 쉬어져요. 특히 계단을 오르거나 조금만 움직여도 숨이 차고 어지러워요.\n\n**간호사**: 언제부터 이런 증상이 있었나요? 그리고 증상이 점점 심해지고 있나요?\n\n**환자**: 약 일주일 전부터 시작됐어요. 처음에는 가벼운 피로감 정도였는데, 3일 전부터는 확실히 숨이 차고 가슴이 답답한 느낌이 심해졌어요. 어제는 밤에 누워있는데 갑자기 숨이 막히는 느낌이 들어서 깼어요.\n\n**간호사**: 다른 증상은 없으신가요? 예를 들어 가슴 통증, 발열, 기침, 발목 부종 같은 것들이요.\n\n**환자**: 가슴 통증은 약간 있어요. 쥐어짜는 듯한 통증이 아니라 둔하게 아픈 느낌이에요. 그리고 발목이 좀 부어있는 것 같아요. 신발이 잘 안 들어가더라고요.\n\n## 검사 및 치료 중\n**간호사**: 검사 결과가 나왔습니다. 심전도와 혈액 검사, 흉부 X-ray를 종합해 봤을 때, 심부전 초기 증상으로 보입니다. 의사 선생님께서 곧 자세한 설명과 치료 계획을 알려주실 거예요.\n\n**환자**: 심부전이요? 그게 심장이 멈추는 건가요? 너무 무서워요. 제가 많이 위험한가요?\n\n**간호사**: 심부전이라는 말이 무섭게 들릴 수 있지만, 심장이 완전히 멈추는 것은 아니에요. 심장이 몸에 필요한 만큼 충분히 혈액을 펌프질하지 못하는 상태를 말합니다. 초기에 발견했고, 적절한 치료와 생활습관 개선으로 잘 관리할 수 있어요. 지금은 약물 치료를 시작하고 증상을 완화시키는 것이 중요합니다.\n\n**환자**: 그렇군요. 조금 안심이 되네요. 치료는 어떻게 진행되나요? 입원해야 하나요?\n\n**간호사**: 네, 며칠간 입원하시면서 약물 치료를 시작하고 상태를 모니터링할 예정입니다. 이뇨제를 투여해서 체내 과잉 수분을 배출하고, 심장 기능을 개선하는 약물도 함께 사용할 거예요. 또한 저염식이를 시작하고, 수분 섭취량도 조절할 필요가 있습니다.\n\n**환자**: 알겠습니다. 제가 평소에 짠 음식을 좋아했는데, 이제 조심해야겠네요. 그런데 이 병이 완전히 나을 수 있는 건가요?\n\n**간호사**: 심부전은 완전히 치료되기보다는 잘 관리하는 것이 중요한 만성 질환입니다. 하지만 약물 치료와 생활습관 개선으로 증상을 크게 완화하고 정상적인 일상생활을 유지할 수 있어요. 규칙적인 운동, 저염식이, 금연, 적절한 체중 유지가 중요합니다. 물론 처음에는 천천히 시작하고, 상태가 좋아지면 점차 활동량을 늘려갈 수 있어요.\n\n## 회복기\n**간호사**: 3일간의 치료 후에 상태가 많이 좋아지셨네요. 호흡곤란도 줄었고, 발목 부종도 감소했습니다. 약물 반응이 좋은 편이에요.\n\n**환자**: 네, 확실히 숨쉬기가 한결 편해졌어요. 처음에는 화장실 가는 것도 힘들었는데, 이제는 병실 주변을 걸어다닐 수 있을 정도가 됐어요. 그런데 퇴원 후에는 어떻게 관리해야 하나요?\n\n**간호사**: 퇴원 후에도 약물 복용을 꾸준히 하셔야 합니다. 처방된 약을 정확한 시간에 복용하는 것이 중요해요. 또한 매일 체중을 측정하셔서 갑자기 체중이 증가하면(2-3일 내에 1.5kg 이상) 바로 연락주세요. 이는 체내에 수분이 다시 축적되고 있다는 신호일 수 있습니다.\n\n**환자**: 알겠습니다. 식이요법은 어떻게 해야 할까요? 소금을 완전히 끊어야 하나요?\n\n**간호사**: 완전히 끊을 필요는 없지만, 하루 소금 섭취량을 2g 이하로 제한하는 것이 좋습니다. 가공식품, 패스트푸드, 절임식품은 피하시고, 신선한 재료로 조리한 음식을 드세요. 또한 수분 섭취도 하루 1.5-2리터로 제한하는 것이 좋습니다. 퇴원 전에 영양사 선생님과 상담 일정을 잡아드릴게요.\n\n**환자**: 운동은 어느 정도 해도 괜찮을까요? 전에는 가끔 등산도 했었는데요.\n\n**간호사**: 처음에는 가벼운 산책부터 시작하세요. 하루 10-15분 정도로 시작해서 점차 늘려가는 것이 좋습니다. 숨이 차거나 피로감이 심하면 즉시 중단하고 휴식을 취하세요. 등산 같은 격렬한 운동은 의사 선생님과 상담 후에 결정하는 것이 좋습니다. 2주 후에 외래 진료가 예약되어 있으니, 그때 운동 강도에 대해 상담하실 수 있어요.\n\n**환자**: 정말 감사합니다. 처음에는 너무 무서웠는데, 이제 어떻게 관리해야 할지 알게 되어 안심이 됩니다. 앞으로 건강관리에 더 신경 쓰도록 할게요.\n\n**간호사**: 네, 좋은 마음가짐이세요. 저희가 계속 도와드릴게요. 퇴원 후에도 궁금한 점이 있으시면 언제든지 연락주세요. 심부전 환자 자조 모임도 있으니 참여해보시는 것도 좋을 것 같아요. 다른 환자분들의 경험과 조언이 많은 도움이 될 수 있습니다.\n          `;\n\n          // Firestore에 업데이트\n          const scenarioDoc = doc(db, 'scenarios', scenario.id);\n          await updateDoc(scenarioDoc, {\n            patient_conversation: scenario.patient_conversation\n          });\n        }\n        commit('SET_CURRENT_SCENARIO', scenario);\n        commit('SET_LOADING', false);\n        return scenario;\n      } catch (error) {\n        console.error('시나리오 조회 실패:', error);\n        commit('SET_ERROR', error.message);\n        commit('SET_LOADING', false);\n        throw error;\n      }\n    },\n    // 시나리오 생성\n    async createScenario({\n      commit,\n      getters\n    }, scenarioData) {\n      commit('SET_LOADING', true);\n      commit('CLEAR_ERROR');\n      try {\n        // 사용자가 로그인되어 있는지 확인\n        if (!getters.isLoggedIn) {\n          throw new Error('로그인이 필요합니다.');\n        }\n        console.log('시나리오 생성 요청 데이터:', scenarioData);\n\n        // OpenAI API를 통해 시나리오 생성\n        const response = await axios.post('/api/scenarios/generate/', {\n          ...scenarioData,\n          age: scenarioData.age || '30',\n          // 나이 수동 입력 지원\n          past_medical_history: scenarioData.past_medical_history || '없음',\n          family_history: scenarioData.family_history || '없음',\n          allergies: scenarioData.allergies || '없음',\n          major_symptoms: scenarioData.major_symptoms || '없음',\n          include_conversation: true // 환자와의 대화 포함 요청\n        });\n        console.log('시나리오 생성 응답:', response.data);\n\n        // 응답에서 환자와의 대화 확인\n        if (!response.data.patient_conversation) {\n          console.warn('환자와의 대화가 응답에 포함되어 있지 않습니다.');\n        }\n\n        // Firebase Firestore에 시나리오 저장\n        const db = getFirestore();\n        const scenariosRef = collection(db, 'scenarios');\n\n        // 시나리오 데이터 준비\n        const scenarioToSave = {\n          id: response.data.id.toString(),\n          title: response.data.title,\n          main_disease: response.data.main_disease,\n          personal_info: response.data.personal_info,\n          additional_info: response.data.additional_info || '',\n          content: response.data.content,\n          patient_conversation: response.data.patient_conversation || '',\n          created_by: getters.currentUser ? {\n            id: getters.currentUser.id,\n            username: getters.currentUser.username,\n            email: getters.currentUser.email\n          } : null,\n          created_at: new Date().toISOString(),\n          updated_at: new Date().toISOString()\n        };\n\n        // Firestore에 저장\n        await addDoc(scenariosRef, scenarioToSave);\n\n        // 생성된 시나리오를 현재 시나리오로 설정\n        commit('SET_CURRENT_SCENARIO', response.data);\n        commit('SET_LOADING', false);\n        return response.data;\n      } catch (error) {\n        console.error('시나리오 생성 실패:', error);\n        commit('SET_ERROR', error.message || '시나리오 생성 중 오류가 발생했습니다.');\n        commit('SET_LOADING', false);\n        throw error;\n      }\n    },\n    // 시나리오 수정\n    async modifyScenario({\n      commit,\n      getters\n    }, {\n      scenarioId,\n      userInput\n    }) {\n      commit('SET_LOADING', true);\n      commit('CLEAR_ERROR');\n      try {\n        // OpenAI API를 통해 시나리오 수정\n        const response = await axios.post('/api/modifications/modify/', {\n          scenario_id: scenarioId,\n          user_input: userInput\n        });\n\n        // Firebase Firestore에 수정 기록 저장\n        const db = getFirestore();\n        const modificationsRef = collection(db, 'modifications');\n        const modification = {\n          scenario_id: scenarioId,\n          user_input: userInput,\n          modified_content: response.data.modified_content,\n          created_at: new Date().toISOString(),\n          created_by: {\n            id: getters.currentUser.id,\n            username: getters.currentUser.username,\n            email: getters.currentUser.email,\n            is_admin: getters.currentUser.is_admin\n          }\n        };\n        const docRef = await addDoc(modificationsRef, modification);\n\n        // 시나리오 내용 업데이트\n        const scenarioRef = doc(db, 'scenarios', scenarioId);\n        await updateDoc(scenarioRef, {\n          content: response.data.modified_content,\n          updated_at: new Date().toISOString()\n        });\n\n        // 현재 시나리오 업데이트\n        if (getters.currentScenario && getters.currentScenario.id === scenarioId) {\n          const updatedScenario = {\n            ...getters.currentScenario,\n            content: response.data.modified_content,\n            updated_at: new Date().toISOString()\n          };\n          commit('SET_CURRENT_SCENARIO', updatedScenario);\n        }\n        commit('SET_LOADING', false);\n        return {\n          id: docRef.id,\n          ...modification\n        };\n      } catch (error) {\n        commit('SET_ERROR', error.message);\n        commit('SET_LOADING', false);\n        throw error;\n      }\n    }\n  }\n});\nexport default store;","map":{"version":3,"names":["createStore","axios","getAuth","signInWithEmailAndPassword","createUserWithEmailAndPassword","signOut","onAuthStateChanged","getFirestore","collection","addDoc","getDocs","doc","getDoc","updateDoc","query","orderBy","where","defaults","baseURL","process","env","VUE_APP_API_URL","interceptors","request","use","config","adminUser","localStorage","getItem","tempUser","user","JSON","parse","headers","email","error","Promise","reject","response","status","console","data","store","state","scenarios","currentScenario","loading","getters","isLoggedIn","currentUser","isAdmin","is_admin","isLoading","mutations","SET_USER","SET_SCENARIOS","SET_CURRENT_SCENARIO","scenario","SET_LOADING","SET_ERROR","CLEAR_ERROR","actions","checkAuth","commit","login","password","id","username","setItem","stringify","includes","length","Date","now","split","created_at","toISOString","Error","message","register","auth","userCredential","db","userRef","newUser","docRef","logout","removeItem","fetchScenarios","scenariosRef","q","querySnapshot","forEach","push","fetchScenario","log","toString","empty","docs","get","title","main_disease","personal_info","additional_info","content","patient_conversation","created_by","updated_at","trim","scenarioDoc","createScenario","scenarioData","post","age","past_medical_history","family_history","allergies","major_symptoms","include_conversation","warn","scenarioToSave","modifyScenario","scenarioId","userInput","scenario_id","user_input","modificationsRef","modification","modified_content","scenarioRef","updatedScenario"],"sources":["D:/간호시뮬레이션/frontend/src/store/index.js"],"sourcesContent":["import { createStore } from 'vuex'\r\nimport axios from 'axios'\r\nimport { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth'\r\nimport { getFirestore, collection, addDoc, getDocs, doc, getDoc, updateDoc, query, orderBy, where } from 'firebase/firestore'\r\n\r\n// API 기본 URL 설정\r\naxios.defaults.baseURL = process.env.VUE_APP_API_URL || 'http://localhost:8000'\r\n\r\n// axios 인터셉터 설정\r\naxios.interceptors.request.use(\r\n  config => {\r\n    // 로컬 스토리지에서 사용자 정보 가져오기\r\n    const adminUser = localStorage.getItem('adminUser')\r\n    const tempUser = localStorage.getItem('tempUser')\r\n    const user = adminUser ? JSON.parse(adminUser) : (tempUser ? JSON.parse(tempUser) : null)\r\n    \r\n    // 사용자가 로그인한 경우 헤더에 인증 정보 추가\r\n    if (user) {\r\n      // 실제 토큰이 없으므로 임시 인증 헤더 추가\r\n      config.headers['Authorization'] = `Bearer dummy-token-for-${user.email}`\r\n    } else {\r\n      // 사용자 정보가 없는 경우에도 임시 인증 헤더 추가 (401 에러 방지)\r\n      config.headers['Authorization'] = `Bearer dummy-token-for-anonymous`\r\n    }\r\n    \r\n    return config\r\n  },\r\n  error => {\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\n// 응답 인터셉터 설정\r\naxios.interceptors.response.use(\r\n  response => {\r\n    return response\r\n  },\r\n  error => {\r\n    // 401 에러 처리 (인증 실패)\r\n    if (error.response && error.response.status === 401) {\r\n      console.error('인증 오류가 발생했습니다:', error.response.data)\r\n      \r\n      // 로그인 페이지로 이동하는 대신 콘솔에 오류 메시지만 출력\r\n      // 로컬 스토리지와 사용자 정보는 유지\r\n      // 로그인 페이지로 리다이렉트하지 않음\r\n    }\r\n    return Promise.reject(error)\r\n  }\r\n)\r\n\r\nconst store = createStore({\r\n  state: {\r\n    user: null,\r\n    scenarios: [],\r\n    currentScenario: null,\r\n    loading: false,\r\n    error: null\r\n  },\r\n  getters: {\r\n    isLoggedIn: state => !!state.user,\r\n    currentUser: state => state.user,\r\n    isAdmin: state => state.user && state.user.is_admin,\r\n    scenarios: state => state.scenarios,\r\n    currentScenario: state => state.currentScenario,\r\n    isLoading: state => state.loading,\r\n    error: state => state.error\r\n  },\r\n  mutations: {\r\n    SET_USER(state, user) {\r\n      state.user = user\r\n    },\r\n    SET_SCENARIOS(state, scenarios) {\r\n      state.scenarios = scenarios\r\n    },\r\n    SET_CURRENT_SCENARIO(state, scenario) {\r\n      state.currentScenario = scenario\r\n    },\r\n    SET_LOADING(state, loading) {\r\n      state.loading = loading\r\n    },\r\n    SET_ERROR(state, error) {\r\n      state.error = error\r\n    },\r\n    CLEAR_ERROR(state) {\r\n      state.error = null\r\n    }\r\n  },\r\n  actions: {\r\n    // 인증 상태 확인\r\n    checkAuth({ commit }) {\r\n      // 로컬 스토리지에서 관리자 로그인 상태 확인\r\n      const adminUser = localStorage.getItem('adminUser')\r\n      if (adminUser) {\r\n        commit('SET_USER', JSON.parse(adminUser))\r\n        return\r\n      }\r\n      \r\n      // 로컬 스토리지에서 임시 사용자 로그인 상태 확인\r\n      const tempUser = localStorage.getItem('tempUser')\r\n      if (tempUser) {\r\n        commit('SET_USER', JSON.parse(tempUser))\r\n        return\r\n      }\r\n      \r\n      /* Firebase 인증 코드 주석 처리 (오류 발생)\r\n      const auth = getAuth()\r\n      onAuthStateChanged(auth, async (user) => {\r\n        if (user) {\r\n          try {\r\n            // Firebase 인증 후 사용자 정보 설정\r\n            const db = getFirestore()\r\n            const userRef = collection(db, 'users')\r\n            const q = query(userRef, where('email', '==', user.email))\r\n            const querySnapshot = await getDocs(q)\r\n            \r\n            if (!querySnapshot.empty) {\r\n              // 기존 사용자 정보 가져오기\r\n              const userData = querySnapshot.docs[0].data()\r\n              commit('SET_USER', {\r\n                id: querySnapshot.docs[0].id,\r\n                username: userData.username || user.displayName || user.email,\r\n                email: user.email,\r\n                is_admin: userData.is_admin || false\r\n              })\r\n            } else {\r\n              // 새 사용자 정보 생성\r\n              const newUser = {\r\n                username: user.displayName || user.email,\r\n                email: user.email,\r\n                is_admin: user.email === 'admin@example.com', // 관리자 계정 설정\r\n                created_at: new Date().toISOString()\r\n              }\r\n              \r\n              const docRef = await addDoc(userRef, newUser)\r\n              commit('SET_USER', {\r\n                id: docRef.id,\r\n                ...newUser\r\n              })\r\n            }\r\n          } catch (error) {\r\n            console.error('사용자 정보 가져오기 실패:', error)\r\n            commit('SET_USER', null)\r\n          }\r\n        } else {\r\n          commit('SET_USER', null)\r\n        }\r\n      })\r\n      */\r\n    },\r\n    \r\n    // 로그인\r\n    async login({ commit }, { email, password }) {\r\n      commit('SET_LOADING', true)\r\n      commit('CLEAR_ERROR')\r\n      \r\n      try {\r\n        // 관리자 계정 특별 처리 (admin@example.com / password123!)\r\n        if (email === 'admin@example.com' && password === 'password123!') {\r\n          const adminUser = {\r\n            id: 'admin-user-id',\r\n            username: 'Admin',\r\n            email: 'admin@example.com',\r\n            is_admin: true\r\n          }\r\n          commit('SET_USER', adminUser)\r\n          // 관리자 계정 정보를 로컬 스토리지에 저장\r\n          localStorage.setItem('adminUser', JSON.stringify(adminUser))\r\n          commit('SET_LOADING', false)\r\n          return adminUser\r\n        }\r\n        \r\n        // 일반 사용자 처리 (Firebase 인증 없이 임시 처리)\r\n        // Firebase 인증 오류 방지를 위해 임시 사용자 생성\r\n        if (email && email.includes('@') && password && password.length >= 6) {\r\n          const tempUser = {\r\n            id: 'user-' + Date.now(),\r\n            username: email.split('@')[0],\r\n            email: email,\r\n            is_admin: false,\r\n            created_at: new Date().toISOString()\r\n          }\r\n          \r\n          commit('SET_USER', tempUser)\r\n          localStorage.setItem('tempUser', JSON.stringify(tempUser))\r\n          commit('SET_LOADING', false)\r\n          return tempUser\r\n        } else {\r\n          throw new Error('유효한 이메일과 6자 이상의 비밀번호를 입력해주세요.')\r\n        }\r\n        \r\n        /* Firebase 인증 코드 주석 처리 (오류 발생)\r\n        const auth = getAuth()\r\n        const userCredential = await signInWithEmailAndPassword(auth, email, password)\r\n        \r\n        // Firebase 인증 후 사용자 정보 설정\r\n        const db = getFirestore()\r\n        const userRef = collection(db, 'users')\r\n        const q = query(userRef, where('email', '==', userCredential.user.email))\r\n        const querySnapshot = await getDocs(q)\r\n        \r\n        if (!querySnapshot.empty) {\r\n          // 기존 사용자 정보 가져오기\r\n          const userData = querySnapshot.docs[0].data()\r\n          const user = {\r\n            id: querySnapshot.docs[0].id,\r\n            username: userData.username || userCredential.user.displayName || userCredential.user.email,\r\n            email: userCredential.user.email,\r\n            is_admin: userData.is_admin || false\r\n          }\r\n          commit('SET_USER', user)\r\n          commit('SET_LOADING', false)\r\n          return user\r\n        } else {\r\n          // 새 사용자 정보 생성\r\n          const newUser = {\r\n            username: userCredential.user.displayName || userCredential.user.email,\r\n            email: userCredential.user.email,\r\n            is_admin: userCredential.user.email === 'admin@example.com', // 관리자 계정 설정\r\n            created_at: new Date().toISOString()\r\n          }\r\n          \r\n          const docRef = await addDoc(userRef, newUser)\r\n          const user = {\r\n            id: docRef.id,\r\n            ...newUser\r\n          }\r\n          commit('SET_USER', user)\r\n          commit('SET_LOADING', false)\r\n          return user\r\n        }\r\n        */\r\n      } catch (error) {\r\n        commit('SET_ERROR', error.message)\r\n        commit('SET_LOADING', false)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 회원가입\r\n    async register({ commit }, { username, email, password }) {\r\n      commit('SET_LOADING', true)\r\n      commit('CLEAR_ERROR')\r\n      \r\n      try {\r\n        const auth = getAuth()\r\n        const userCredential = await createUserWithEmailAndPassword(auth, email, password)\r\n        \r\n        // Firebase Firestore에 사용자 정보 저장\r\n        const db = getFirestore()\r\n        const userRef = collection(db, 'users')\r\n        \r\n        const newUser = {\r\n          username,\r\n          email: userCredential.user.email,\r\n          is_admin: email === 'admin@example.com', // 관리자 계정 설정\r\n          created_at: new Date().toISOString()\r\n        }\r\n        \r\n        const docRef = await addDoc(userRef, newUser)\r\n        const user = {\r\n          id: docRef.id,\r\n          ...newUser\r\n        }\r\n        \r\n        commit('SET_USER', user)\r\n        commit('SET_LOADING', false)\r\n        return user\r\n      } catch (error) {\r\n        commit('SET_ERROR', error.message)\r\n        commit('SET_LOADING', false)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 로그아웃\r\n    async logout({ commit }) {\r\n      try {\r\n        // 로컬 스토리지에서 관리자 계정 정보 삭제\r\n        localStorage.removeItem('adminUser')\r\n        // 로컬 스토리지에서 임시 사용자 정보 삭제\r\n        localStorage.removeItem('tempUser')\r\n        \r\n        /* Firebase 인증 코드 주석 처리 (오류 발생)\r\n        const auth = getAuth()\r\n        await signOut(auth)\r\n        */\r\n        \r\n        commit('SET_USER', null)\r\n      } catch (error) {\r\n        commit('SET_ERROR', error.message)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 시나리오 목록 가져오기\r\n    async fetchScenarios({ commit }) {\r\n      commit('SET_LOADING', true)\r\n      commit('CLEAR_ERROR')\r\n      \r\n      try {\r\n        // Firebase Firestore에서 시나리오 목록 가져오기\r\n        const db = getFirestore()\r\n        const scenariosRef = collection(db, 'scenarios')\r\n        const q = query(scenariosRef, orderBy('created_at', 'desc'))\r\n        const querySnapshot = await getDocs(q)\r\n        \r\n        const scenarios = []\r\n        querySnapshot.forEach((doc) => {\r\n          scenarios.push({\r\n            id: doc.id,\r\n            ...doc.data()\r\n          })\r\n        })\r\n        \r\n        commit('SET_SCENARIOS', scenarios)\r\n        commit('SET_LOADING', false)\r\n        return scenarios\r\n      } catch (error) {\r\n        commit('SET_ERROR', error.message)\r\n        commit('SET_LOADING', false)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 시나리오 상세 정보 가져오기\r\n    async fetchScenario({ commit }, id) {\r\n      commit('SET_LOADING', true)\r\n      commit('CLEAR_ERROR')\r\n      \r\n      try {\r\n        console.log(`시나리오 ID ${id} 조회 중...`)\r\n        \r\n        // Firestore에서 시나리오 조회\r\n        const db = getFirestore()\r\n        const scenariosRef = collection(db, 'scenarios')\r\n        const q = query(scenariosRef, where('id', '==', id.toString()))\r\n        const querySnapshot = await getDocs(q)\r\n        \r\n        let scenario = null\r\n        \r\n        if (!querySnapshot.empty) {\r\n          // Firestore에서 시나리오 찾음\r\n          const doc = querySnapshot.docs[0]\r\n          scenario = { id: doc.id, ...doc.data() }\r\n          console.log('Firestore에서 시나리오 찾음:', scenario)\r\n        } else {\r\n          // Firestore에 없는 경우 백엔드 API 호출\r\n          console.log('Firestore에 시나리오가 없어 백엔드 API 호출')\r\n          const response = await axios.get(`/api/scenarios/${id}/`)\r\n          scenario = response.data\r\n          console.log('백엔드 API에서 시나리오 찾음:', scenario)\r\n          \r\n          // Firestore에 저장\r\n          await addDoc(scenariosRef, {\r\n            id: scenario.id.toString(),\r\n            title: scenario.title,\r\n            main_disease: scenario.main_disease,\r\n            personal_info: scenario.personal_info,\r\n            additional_info: scenario.additional_info || '',\r\n            content: scenario.content,\r\n            patient_conversation: scenario.patient_conversation || '',\r\n            created_by: scenario.created_by ? {\r\n              id: scenario.created_by.id,\r\n              username: scenario.created_by.username,\r\n              email: scenario.created_by.email\r\n            } : null,\r\n            created_at: scenario.created_at,\r\n            updated_at: scenario.updated_at\r\n          })\r\n        }\r\n        \r\n        // 환자와의 대화가 없는 경우 기본 대화 설정\r\n        if (!scenario.patient_conversation || scenario.patient_conversation.trim() === '') {\r\n          console.log('환자와의 대화가 없어 기본 대화 설정')\r\n          scenario.patient_conversation = `\r\n# 환자와의 대화\r\n\r\n## 초기 평가\r\n**간호사**: 안녕하세요, 저는 오늘 담당 간호사입니다. 어떻게 지내세요? 어디가 불편하신가요?\r\n\r\n**환자**: 안녕하세요, 간호사님. 사실 며칠 전부터 계속 가슴이 답답하고 숨이 잘 안 쉬어져요. 특히 계단을 오르거나 조금만 움직여도 숨이 차고 어지러워요.\r\n\r\n**간호사**: 언제부터 이런 증상이 있었나요? 그리고 증상이 점점 심해지고 있나요?\r\n\r\n**환자**: 약 일주일 전부터 시작됐어요. 처음에는 가벼운 피로감 정도였는데, 3일 전부터는 확실히 숨이 차고 가슴이 답답한 느낌이 심해졌어요. 어제는 밤에 누워있는데 갑자기 숨이 막히는 느낌이 들어서 깼어요.\r\n\r\n**간호사**: 다른 증상은 없으신가요? 예를 들어 가슴 통증, 발열, 기침, 발목 부종 같은 것들이요.\r\n\r\n**환자**: 가슴 통증은 약간 있어요. 쥐어짜는 듯한 통증이 아니라 둔하게 아픈 느낌이에요. 그리고 발목이 좀 부어있는 것 같아요. 신발이 잘 안 들어가더라고요.\r\n\r\n## 검사 및 치료 중\r\n**간호사**: 검사 결과가 나왔습니다. 심전도와 혈액 검사, 흉부 X-ray를 종합해 봤을 때, 심부전 초기 증상으로 보입니다. 의사 선생님께서 곧 자세한 설명과 치료 계획을 알려주실 거예요.\r\n\r\n**환자**: 심부전이요? 그게 심장이 멈추는 건가요? 너무 무서워요. 제가 많이 위험한가요?\r\n\r\n**간호사**: 심부전이라는 말이 무섭게 들릴 수 있지만, 심장이 완전히 멈추는 것은 아니에요. 심장이 몸에 필요한 만큼 충분히 혈액을 펌프질하지 못하는 상태를 말합니다. 초기에 발견했고, 적절한 치료와 생활습관 개선으로 잘 관리할 수 있어요. 지금은 약물 치료를 시작하고 증상을 완화시키는 것이 중요합니다.\r\n\r\n**환자**: 그렇군요. 조금 안심이 되네요. 치료는 어떻게 진행되나요? 입원해야 하나요?\r\n\r\n**간호사**: 네, 며칠간 입원하시면서 약물 치료를 시작하고 상태를 모니터링할 예정입니다. 이뇨제를 투여해서 체내 과잉 수분을 배출하고, 심장 기능을 개선하는 약물도 함께 사용할 거예요. 또한 저염식이를 시작하고, 수분 섭취량도 조절할 필요가 있습니다.\r\n\r\n**환자**: 알겠습니다. 제가 평소에 짠 음식을 좋아했는데, 이제 조심해야겠네요. 그런데 이 병이 완전히 나을 수 있는 건가요?\r\n\r\n**간호사**: 심부전은 완전히 치료되기보다는 잘 관리하는 것이 중요한 만성 질환입니다. 하지만 약물 치료와 생활습관 개선으로 증상을 크게 완화하고 정상적인 일상생활을 유지할 수 있어요. 규칙적인 운동, 저염식이, 금연, 적절한 체중 유지가 중요합니다. 물론 처음에는 천천히 시작하고, 상태가 좋아지면 점차 활동량을 늘려갈 수 있어요.\r\n\r\n## 회복기\r\n**간호사**: 3일간의 치료 후에 상태가 많이 좋아지셨네요. 호흡곤란도 줄었고, 발목 부종도 감소했습니다. 약물 반응이 좋은 편이에요.\r\n\r\n**환자**: 네, 확실히 숨쉬기가 한결 편해졌어요. 처음에는 화장실 가는 것도 힘들었는데, 이제는 병실 주변을 걸어다닐 수 있을 정도가 됐어요. 그런데 퇴원 후에는 어떻게 관리해야 하나요?\r\n\r\n**간호사**: 퇴원 후에도 약물 복용을 꾸준히 하셔야 합니다. 처방된 약을 정확한 시간에 복용하는 것이 중요해요. 또한 매일 체중을 측정하셔서 갑자기 체중이 증가하면(2-3일 내에 1.5kg 이상) 바로 연락주세요. 이는 체내에 수분이 다시 축적되고 있다는 신호일 수 있습니다.\r\n\r\n**환자**: 알겠습니다. 식이요법은 어떻게 해야 할까요? 소금을 완전히 끊어야 하나요?\r\n\r\n**간호사**: 완전히 끊을 필요는 없지만, 하루 소금 섭취량을 2g 이하로 제한하는 것이 좋습니다. 가공식품, 패스트푸드, 절임식품은 피하시고, 신선한 재료로 조리한 음식을 드세요. 또한 수분 섭취도 하루 1.5-2리터로 제한하는 것이 좋습니다. 퇴원 전에 영양사 선생님과 상담 일정을 잡아드릴게요.\r\n\r\n**환자**: 운동은 어느 정도 해도 괜찮을까요? 전에는 가끔 등산도 했었는데요.\r\n\r\n**간호사**: 처음에는 가벼운 산책부터 시작하세요. 하루 10-15분 정도로 시작해서 점차 늘려가는 것이 좋습니다. 숨이 차거나 피로감이 심하면 즉시 중단하고 휴식을 취하세요. 등산 같은 격렬한 운동은 의사 선생님과 상담 후에 결정하는 것이 좋습니다. 2주 후에 외래 진료가 예약되어 있으니, 그때 운동 강도에 대해 상담하실 수 있어요.\r\n\r\n**환자**: 정말 감사합니다. 처음에는 너무 무서웠는데, 이제 어떻게 관리해야 할지 알게 되어 안심이 됩니다. 앞으로 건강관리에 더 신경 쓰도록 할게요.\r\n\r\n**간호사**: 네, 좋은 마음가짐이세요. 저희가 계속 도와드릴게요. 퇴원 후에도 궁금한 점이 있으시면 언제든지 연락주세요. 심부전 환자 자조 모임도 있으니 참여해보시는 것도 좋을 것 같아요. 다른 환자분들의 경험과 조언이 많은 도움이 될 수 있습니다.\r\n          `\r\n          \r\n          // Firestore에 업데이트\r\n          const scenarioDoc = doc(db, 'scenarios', scenario.id)\r\n          await updateDoc(scenarioDoc, {\r\n            patient_conversation: scenario.patient_conversation\r\n          })\r\n        }\r\n        \r\n        commit('SET_CURRENT_SCENARIO', scenario)\r\n        commit('SET_LOADING', false)\r\n        return scenario\r\n      } catch (error) {\r\n        console.error('시나리오 조회 실패:', error)\r\n        commit('SET_ERROR', error.message)\r\n        commit('SET_LOADING', false)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 시나리오 생성\r\n    async createScenario({ commit, getters }, scenarioData) {\r\n      commit('SET_LOADING', true)\r\n      commit('CLEAR_ERROR')\r\n      \r\n      try {\r\n        // 사용자가 로그인되어 있는지 확인\r\n        if (!getters.isLoggedIn) {\r\n          throw new Error('로그인이 필요합니다.')\r\n        }\r\n        \r\n        console.log('시나리오 생성 요청 데이터:', scenarioData)\r\n        \r\n        // OpenAI API를 통해 시나리오 생성\r\n        const response = await axios.post('/api/scenarios/generate/', {\r\n          ...scenarioData,\r\n          age: scenarioData.age || '30', // 나이 수동 입력 지원\r\n          past_medical_history: scenarioData.past_medical_history || '없음',\r\n          family_history: scenarioData.family_history || '없음',\r\n          allergies: scenarioData.allergies || '없음',\r\n          major_symptoms: scenarioData.major_symptoms || '없음',\r\n          include_conversation: true // 환자와의 대화 포함 요청\r\n        })\r\n        \r\n        console.log('시나리오 생성 응답:', response.data)\r\n        \r\n        // 응답에서 환자와의 대화 확인\r\n        if (!response.data.patient_conversation) {\r\n          console.warn('환자와의 대화가 응답에 포함되어 있지 않습니다.')\r\n        }\r\n        \r\n        // Firebase Firestore에 시나리오 저장\r\n        const db = getFirestore()\r\n        const scenariosRef = collection(db, 'scenarios')\r\n        \r\n        // 시나리오 데이터 준비\r\n        const scenarioToSave = {\r\n          id: response.data.id.toString(),\r\n          title: response.data.title,\r\n          main_disease: response.data.main_disease,\r\n          personal_info: response.data.personal_info,\r\n          additional_info: response.data.additional_info || '',\r\n          content: response.data.content,\r\n          patient_conversation: response.data.patient_conversation || '',\r\n          created_by: getters.currentUser ? {\r\n            id: getters.currentUser.id,\r\n            username: getters.currentUser.username,\r\n            email: getters.currentUser.email\r\n          } : null,\r\n          created_at: new Date().toISOString(),\r\n          updated_at: new Date().toISOString()\r\n        }\r\n        \r\n        // Firestore에 저장\r\n        await addDoc(scenariosRef, scenarioToSave)\r\n        \r\n        // 생성된 시나리오를 현재 시나리오로 설정\r\n        commit('SET_CURRENT_SCENARIO', response.data)\r\n        commit('SET_LOADING', false)\r\n        \r\n        return response.data\r\n      } catch (error) {\r\n        console.error('시나리오 생성 실패:', error)\r\n        commit('SET_ERROR', error.message || '시나리오 생성 중 오류가 발생했습니다.')\r\n        commit('SET_LOADING', false)\r\n        throw error\r\n      }\r\n    },\r\n    \r\n    // 시나리오 수정\r\n    async modifyScenario({ commit, getters }, { scenarioId, userInput }) {\r\n      commit('SET_LOADING', true)\r\n      commit('CLEAR_ERROR')\r\n      \r\n      try {\r\n        // OpenAI API를 통해 시나리오 수정\r\n        const response = await axios.post('/api/modifications/modify/', {\r\n          scenario_id: scenarioId,\r\n          user_input: userInput\r\n        })\r\n        \r\n        // Firebase Firestore에 수정 기록 저장\r\n        const db = getFirestore()\r\n        const modificationsRef = collection(db, 'modifications')\r\n        \r\n        const modification = {\r\n          scenario_id: scenarioId,\r\n          user_input: userInput,\r\n          modified_content: response.data.modified_content,\r\n          created_at: new Date().toISOString(),\r\n          created_by: {\r\n            id: getters.currentUser.id,\r\n            username: getters.currentUser.username,\r\n            email: getters.currentUser.email,\r\n            is_admin: getters.currentUser.is_admin\r\n          }\r\n        }\r\n        \r\n        const docRef = await addDoc(modificationsRef, modification)\r\n        \r\n        // 시나리오 내용 업데이트\r\n        const scenarioRef = doc(db, 'scenarios', scenarioId)\r\n        await updateDoc(scenarioRef, {\r\n          content: response.data.modified_content,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        \r\n        // 현재 시나리오 업데이트\r\n        if (getters.currentScenario && getters.currentScenario.id === scenarioId) {\r\n          const updatedScenario = {\r\n            ...getters.currentScenario,\r\n            content: response.data.modified_content,\r\n            updated_at: new Date().toISOString()\r\n          }\r\n          commit('SET_CURRENT_SCENARIO', updatedScenario)\r\n        }\r\n        \r\n        commit('SET_LOADING', false)\r\n        return {\r\n          id: docRef.id,\r\n          ...modification\r\n        }\r\n      } catch (error) {\r\n        commit('SET_ERROR', error.message)\r\n        commit('SET_LOADING', false)\r\n        throw error\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\nexport default store\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}